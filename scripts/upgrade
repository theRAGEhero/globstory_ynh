#!/bin/bash

source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# STANDARD UPGRADE STEPS
#=================================================
# ENSURE DOWNWARD COMPATIBILITY
#=================================================
ynh_script_progression "Ensuring downward compatibility..."

# If install_dir doesn't exist, create it
if [ -z "$install_dir" ]; then
    install_dir="/var/www/$app"
    ynh_app_setting_set --app=$app --key=install_dir --value=$install_dir
fi

#=================================================
# UPGRADE APP FILES
#=================================================
ynh_script_progression "Upgrading app files..."

# Update app files from source
cp -r /home/ale/Documents/claude-fileSystem/YUNOHOST/globstory/css "$install_dir"/
cp -r /home/ale/Documents/claude-fileSystem/YUNOHOST/globstory/js "$install_dir"/
cp -r /home/ale/Documents/claude-fileSystem/YUNOHOST/globstory/images "$install_dir"/
cp /home/ale/Documents/claude-fileSystem/YUNOHOST/globstory/app.html "$install_dir"/

# Set permissions
chown -R $app:www-data "$install_dir"

#=================================================
# NGINX CONFIGURATION
#=================================================
ynh_script_progression "Upgrading NGINX web server configuration..."

# Create a dedicated NGINX config
ynh_config_add_nginx

#=================================================
# END OF SCRIPT
#=================================================

ynh_script_progression "Upgrade of $app completed"
